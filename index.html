<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Barcode Generator</title>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
                align-items: flex-start;
                padding-top: 20px;
            }
        }

        .container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                border-radius: 15px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
                border-radius: 10px;
            }
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2em;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.75em;
                margin-bottom: 20px;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.5em;
                margin-bottom: 15px;
            }
        }

        .input-group {
            margin-bottom: 20px;
        }

        .details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        @media (max-width: 480px) {
            .details-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        #codeInput,
        #finishInput,
        #sizeInput,
        #qtyInput,
        #mrpInput {
            font-weight: normal;
        }

        @media (max-width: 480px) {
            input[type="text"] {
                padding: 10px 12px;
                font-size: 16px;
            }
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }


        button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        @media (max-width: 480px) {
            button {
                padding: 12px;
                font-size: 15px;
            }
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .secondary-btn {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            padding: 10px 16px;
            font-size: 14px;
            width: auto;
        }

        .secondary-btn:hover {
            box-shadow: 0 5px 20px rgba(17, 153, 142, 0.4);
        }

        @media (max-width: 480px) {
            .button-group {
                flex-direction: column;
                gap: 8px;
            }

            .secondary-btn {
                width: 100%;
            }
        }

        .hidden {
            display: none;
        }

        .dynamic-field {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .dynamic-field input {
            flex: 1;
        }

        .remove-field-btn {
            padding: 12px 16px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            width: auto;
            min-width: 80px;
        }

        .remove-field-btn:hover {
            background: #c0392b;
        }

        @media (max-width: 480px) {
            .dynamic-field {
                flex-direction: column;
                gap: 8px;
            }

            .remove-field-btn {
                width: 100%;
            }
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .barcode-container {
            margin-top: 30px;
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            display: none;
            overflow-x: auto;
        }

        @media (max-width: 480px) {
            .barcode-container {
                padding: 15px;
                margin-top: 20px;
            }
        }

        .barcode-container.show {
            display: block;
        }

        #barcode {
            margin: 20px auto;
            max-width: 100%;
            height: auto;
        }

        @media (max-width: 480px) {
            #barcode {
                margin: 10px auto;
            }
        }

        .details-display {
            margin-top: 20px;
            text-align: left;
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }

        .details-display p {
            margin: 8px 0;
            color: #333;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .details-display strong {
            text-align: left;
            color: #333;
            font-weight: bold;
            min-width: 80px;
            display: inline-block;
        }

        .details-display .colon {
            text-align: center;
            font-weight: bold;
            width: 20px;
        }

        .details-display .value {
            text-align: left;
            font-weight: bold;
        }

        .custom-fields-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #e0e0e0;
        }

        .custom-field-box {
            border: 2px solid #333;
            padding: 8px;
            background: white;
            border-radius: 0;
        }

        .custom-field-box .field-label {
            font-size: 12px;
            font-weight: bold;
            color: #333;
            margin-bottom: 4px;
            text-transform: uppercase;
        }

        .custom-field-box .field-value {
            font-size: 14px;
            font-weight: bold;
            color: #000;
            word-wrap: break-word;
        }

        @media (max-width: 480px) {
            .details-display {
                padding: 12px;
            }

            .details-display p {
                font-size: 14px;
            }
        }

        .error {
            color: #e74c3c;
            text-align: center;
            margin-top: 15px;
            font-weight: 600;
            display: none;
        }

        .error.show {
            display: block;
        }

        .download-btn {
            margin-top: 15px;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .download-btn:hover {
            box-shadow: 0 5px 20px rgba(17, 153, 142, 0.4);
        }

        .resize-controls {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        .resize-controls.show {
            display: block;
        }

        .resize-controls h3 {
            margin: 0 0 15px 0;
            font-size: 16px;
            color: #333;
        }

        .resize-group {
            margin-bottom: 15px;
        }

        .resize-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #555;
        }

        .resize-group input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .resize-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .resize-group input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }

        .resize-value {
            display: inline-block;
            margin-left: 10px;
            font-weight: 600;
            color: #667eea;
        }

        @media (max-width: 480px) {
            .resize-controls {
                padding: 12px;
            }

            .resize-controls h3 {
                font-size: 14px;
            }
        }

        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }

        .info p {
            color: #1976d2;
            font-size: 14px;
            margin: 5px 0;
        }

        @media (max-width: 480px) {
            .info {
                padding: 12px;
                font-size: 13px;
            }

            .info p {
                font-size: 13px;
            }
        }

        .print-btn {
            margin-top: 15px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .print-btn:hover {
            box-shadow: 0 5px 20px rgba(243, 156, 18, 0.4);
        }

        @media print {
            @page {
                size: 63mm 45mm;
                margin: 0;
            }

            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color: #000 !important;
                border-radius: 0 !important;
                -webkit-border-radius: 0 !important;
                -moz-border-radius: 0 !important;
            }

            html {
                width: 63mm;
                height: 45mm;
                margin: 0;
                padding: 0;
            }

            body {
                width: 63mm !important;
                height: 45mm !important;
                margin: 0 !important;
                padding: 0 !important;
                background: white !important;
                overflow: hidden !important;
            }

            h1, .details-grid, .input-group, .button-group,
            #dynamicFieldsContainer, .error, button, .info, .resize-controls {
                display: none !important;
            }

            .container {
                width: 63mm;
                height: 45mm;
                max-width: 63mm;
                max-height: 45mm;
                padding: 0;
                margin: 0;
                box-shadow: none;
                border-radius: 0;
                background: white;
                overflow: hidden;
            }

            .barcode-container {
                display: flex !important;
                flex-direction: column;
                width: 63mm !important;
                height: 45mm !important;
                max-width: 63mm !important;
                max-height: 45mm !important;
                padding: 1mm 0;
                margin: 0 !important;
                background: white !important;
                box-shadow: none;
                border-radius: 0;
                page-break-after: avoid;
                page-break-inside: avoid;
                overflow: hidden !important;
                position: relative;
                visibility: visible !important;
                opacity: 1 !important;
            }

            .print-btn, .download-btn {
                display: none !important;
            }

            .details-display {
                display: block !important;
                width: 100%;
                max-width: 63mm;
                padding: 0;
                margin: 0;
                background: white;
                border: none;
                flex-shrink: 0;
                text-align: left;
                overflow: hidden;
            }

            .details-display p {
                display: flex !important;
                width: 100%;
                margin: 0.8mm 0;
                line-height: 1.2;
                align-items: flex-start;
            }

            .details-display strong {
                font-weight: bold !important;
                flex-shrink: 0 !important;
                text-align: left !important;
                display: inline-block !important;
                width: 14mm !important;
                min-width: 14mm !important;
                max-width: 14mm !important;
                padding: 0 !important;
                margin: 0 !important;
            }

            .details-display .colon {
                margin: 0 !important;
                flex-shrink: 0 !important;
                text-align: left !important;
                width: auto !important;
                display: inline-block !important;
                margin-right: 2mm !important;
            }

            .details-display .value {
                font-weight: bold;
                flex: 1;
                word-wrap: break-word;
            }

            .custom-fields-container {
                display: grid !important;
                grid-template-columns: 1fr 1fr;
                gap: 1mm;
                margin-top: 1mm;
                padding-top: 1mm;
                border-top: 0.5pt solid #333;
                flex-shrink: 0;
                width: 100%;
                max-width: 63mm;
            }

            .custom-field-box {
                border: 0.5pt solid #333 !important;
                padding: 0.4mm !important;
                background: white !important;
                border-radius: 0 !important;
                -webkit-border-radius: 0 !important;
                -moz-border-radius: 0 !important;
                border-top-left-radius: 0 !important;
                border-top-right-radius: 0 !important;
                border-bottom-left-radius: 0 !important;
                border-bottom-right-radius: 0 !important;
                page-break-inside: avoid;
                max-width: 100%;
                overflow: hidden;
            }

            .custom-field-box .field-label {
                font-weight: bold;
                color: #000;
                margin-bottom: 0.1mm;
                text-transform: uppercase;
                line-height: 0.95;
                word-wrap: break-word;
            }

            .custom-field-box .field-value {
                font-weight: normal;
                color: #000;
                word-wrap: break-word;
                line-height: 0.95;
            }

            #barcode {
                display: block !important;
                width: 63mm !important;
                max-width: 63mm !important;
                max-height: 15mm !important;
                height: auto !important;
                margin: 1mm auto 0 auto;
                flex-shrink: 0;
                overflow: hidden !important;
                object-fit: contain !important;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>üì¶ Product Label Generator</h1>

<!--    <div class="info">-->
<!--        <p><strong>üñ®Ô∏è Godex G500 Printer Setup:</strong></p>-->
<!--        <p>1. In Print Dialog: Select "Godex G500" printer</p>-->
<!--        <p>2. Paper Size: Custom ‚Üí 57mm x 45mm </p>-->
<!--        <p>3. Scale: 100% (Actual Size) - DO NOT use "Fit to Page"</p>-->
<!--        <p>4. Margins: Set all to 0</p>-->
<!--        <p>5. Orientation: Landscape (if label is wider than tall)</p>-->
<!--    </div>-->

    <div class="details-grid">
        <div class="input-group">
            <label for="codeInput">Code:</label>
            <input
                    type="text"
                    id="codeInput"
                    oninput="updateBarcodeNumber()"
                    autofocus
            >
        </div>

        <div class="input-group">
            <label for="finishInput">Finish:</label>
            <input
                    type="text"
                    id="finishInput"
                    oninput="updateBarcodeNumber()"
            >
        </div>

        <div class="input-group">
            <label for="sizeInput">Size:</label>
            <input
                    type="text"
                    id="sizeInput"
                    oninput="updateBarcodeNumber()"
            >
        </div>

        <div class="input-group">
            <label for="qtyInput">Quantity:</label>
            <input
                    type="text"
                    id="qtyInput"
                    oninput="updateBarcodeNumber()"
            >
        </div>

        <div class="input-group hidden" id="mrpGroup">
            <label for="mrpInput">MRP:</label>
            <input
                    type="text"
                    id="mrpInput"
                    oninput="updateBarcodeNumber()"
            >
        </div>
    </div>

    <div class="button-group">
        <button class="secondary-btn" onclick="toggleMRP()">+ Add MRP</button>
        <button class="secondary-btn" onclick="addDynamicField()">+ Add Custom Field</button>
    </div>

    <div id="dynamicFieldsContainer"></div>

    <div class="input-group">
        <label for="barcodeInput">Barcode Number:</label>
        <input
                type="text"
                id="barcodeInput"
                placeholder="Auto-generated from fields above"
        >
    </div>

    <button onclick="generateBarcode()">Generate Product Label</button>

    <div class="error" id="error"></div>

    <div class="resize-controls" id="resizeControls">
        <h3>üé® Resize Label Elements</h3>
        <div class="resize-group">
            <label for="detailsFontSize">Product Details Font Size: <span class="resize-value" id="detailsFontValue">150%</span></label>
            <input type="range" id="detailsFontSize" min="50" max="150" value="150" oninput="resizeElements()">
        </div>
        <div class="resize-group">
            <label for="customFontSize">Custom Fields Font Size: <span class="resize-value" id="customFontValue">100%</span></label>
            <input type="range" id="customFontSize" min="50" max="150" value="100" oninput="resizeElements()">
        </div>
        <div class="resize-group">
            <label for="barcodeSize">Barcode Height: <span class="resize-value" id="barcodeSizeValue">100%</span></label>
            <input type="range" id="barcodeSize" min="50" max="150" value="100" oninput="resizeElements()">
        </div>
        <div class="resize-group">
            <label for="barcodeWidth">Barcode Width: <span class="resize-value" id="barcodeWidthValue">100%</span></label>
            <input type="range" id="barcodeWidth" min="50" max="200" value="100" oninput="resizeElements()">
        </div>
        <button class="secondary-btn" onclick="resetSizes()" style="width: 100%; margin-top: 10px;">Reset to Default</button>
    </div>

    <div class="barcode-container" id="barcodeContainer">
        <div class="details-display" id="detailsDisplay"></div>
        <svg id="barcode"></svg>
        <button class="print-btn" onclick="printBarcode()">Print Label (55x40mm)</button>
        <button class="download-btn" onclick="downloadBarcode()">Download Barcode</button>
    </div>
</div>

<script>
    // Update barcode number based on all fields
    function updateBarcodeNumber() {
        const code = document.getElementById('codeInput').value.trim();
        const finish = document.getElementById('finishInput').value.trim();
        const size = document.getElementById('sizeInput').value.trim();
        const qty = document.getElementById('qtyInput').value.trim();
        const mrp = document.getElementById('mrpInput').value.trim();

        // Collect all non-empty values (excluding custom fields)
        const values = [];
        if (code) values.push(code);
        if (finish) values.push(finish);
        if (size) values.push(size);
        if (qty) values.push(qty);
        if (mrp) values.push(mrp);

        // Join with hyphens
        const barcodeNumber = values.join('-');
        document.getElementById('barcodeInput').value = barcodeNumber;
    }

    function generateBarcode() {
        const input = document.getElementById('barcodeInput').value.trim();
        const barcodeContainer = document.getElementById('barcodeContainer');
        const errorDiv = document.getElementById('error');
        const detailsDisplay = document.getElementById('detailsDisplay');

        // Clear previous error
        errorDiv.classList.remove('show');
        errorDiv.textContent = '';

        // Validate input
        if (!input) {
            showError('Please enter barcode number to generate barcode');
            barcodeContainer.classList.remove('show');
            return;
        }

        try {
            // Get additional details
            const code = document.getElementById('codeInput').value.trim();
            const finish = document.getElementById('finishInput').value.trim();
            const size = document.getElementById('sizeInput').value.trim();
            const qty = document.getElementById('qtyInput').value.trim();
            const mrp = document.getElementById('mrpInput').value.trim();

            // Count total fields
            let productFieldCount = 0;
            if (code) productFieldCount++;
            if (finish) productFieldCount++;
            if (size) productFieldCount++;
            if (qty) productFieldCount++;
            if (mrp) productFieldCount++;

            // Count custom fields
            const dynamicFields = document.querySelectorAll('.dynamic-field');
            const customFieldsArray = [];

            dynamicFields.forEach(field => {
                const label = field.querySelector('input[placeholder="Field Name"]').value.trim();
                const value = field.querySelector('input[placeholder="Field Value"]').value.trim();
                if (label && value) {
                    customFieldsArray.push({ label, value });
                }
            });

            const customFieldCount = customFieldsArray.length;
            const totalFields = productFieldCount + customFieldCount;

            // Calculate dynamic sizing based on total fields
            // More fields = smaller barcode and fonts
            let barcodeHeight, detailsFontSize, customFontSize, barcodeMaxHeight;

            if (totalFields <= 5) {
                // Few fields - larger sizes
                barcodeHeight = 80;
                detailsFontSize = '9pt';
                customFontSize = '8pt';
                barcodeMaxHeight = '16mm';
            } else if (totalFields <= 7) {
                // Medium fields
                barcodeHeight = 70;
                detailsFontSize = '8pt';
                customFontSize = '7pt';
                barcodeMaxHeight = '14mm';
            } else if (totalFields <= 9) {
                // Many fields
                barcodeHeight = 55;
                detailsFontSize = '7pt';
                customFontSize = '6pt';
                barcodeMaxHeight = '12mm';
            } else if (totalFields <= 11) {
                // More fields
                barcodeHeight = 50;
                detailsFontSize = '6pt';
                customFontSize = '5pt';
                barcodeMaxHeight = '10mm';
            } else {
                // Too many fields - minimum sizes
                barcodeHeight = 40;
                detailsFontSize = '5pt';
                customFontSize = '4.5pt';
                barcodeMaxHeight = '8mm';
            }

            // Determine barcode width based on screen size
            // Using wider bars for reliable scanning
            const isMobile = window.innerWidth <= 480;
            const barcodeWidth = isMobile ? 1.5 : 2;
            const screenFontSize = isMobile ? 14 : 18;

            // Generate barcode with CODE128 format
            // Using pure black for maximum scanner contrast
            JsBarcode("#barcode", input, {
                format: 'CODE128',
                width: barcodeWidth,
                height: barcodeHeight,
                displayValue: false,
                fontSize: screenFontSize,
                margin: 10,
                lineColor: "#000000"
            });

            // Apply barcode max-height as inline style for print
            const barcodeElement = document.getElementById('barcode');
            barcodeElement.style.maxHeight = barcodeMaxHeight;

            // Display details if any are provided
            let detailsHTML = '';
            if (code) detailsHTML += `<p><strong>Code</strong><span class="colon">:</span><span class="value">${code}</span></p>`;
            if (finish) detailsHTML += `<p><strong>Finish</strong><span class="colon">:</span><span class="value">${finish}</span></p>`;
            if (size) detailsHTML += `<p><strong>Size</strong><span class="colon">:</span><span class="value">${size}</span></p>`;
            if (qty) detailsHTML += `<p><strong>Qty</strong><span class="colon">:</span><span class="value">${qty}</span></p>`;
            if (mrp) detailsHTML += `<p><strong>MRP</strong><span class="colon">:</span><span class="value">${mrp}</span></p>`;

            // Build custom fields in boxed format
            let customFieldsHTML = '';
            if (customFieldsArray.length > 0) {
                customFieldsHTML = '<div class="custom-fields-container">';
                customFieldsArray.forEach(field => {
                    customFieldsHTML += `
                            <div class="custom-field-box" style="border-radius: 0; -webkit-border-radius: 0; -moz-border-radius: 0;">
                                <div class="field-label">${field.label} :</div>
                                <div class="field-value">${field.value}</div>
                            </div>
                        `;
                });
                customFieldsHTML += '</div>';
            }

            if (detailsHTML || customFieldsHTML) {
                detailsDisplay.innerHTML = detailsHTML + customFieldsHTML;
                detailsDisplay.style.display = 'block';

                // Apply dynamic font sizes for screen view
                detailsDisplay.querySelectorAll('p').forEach(p => {
                    p.style.fontSize = detailsFontSize;
                });
                detailsDisplay.querySelectorAll('.field-label, .field-value').forEach(el => {
                    el.style.fontSize = customFontSize;
                });
            } else {
                detailsDisplay.style.display = 'none';
            }

            barcodeContainer.classList.add('show');

            // Show resize controls and store original sizes
            document.getElementById('resizeControls').classList.add('show');
            window.originalDetailsFontSize = detailsFontSize;
            window.originalCustomFontSize = customFontSize;
            window.originalBarcodeHeight = barcodeHeight;
            window.originalBarcodeWidth = barcodeWidth;

            // Apply the default 150% scale for product details immediately
            resizeElements();
        } catch (error) {
            showError('Error: ' + error.message);
            barcodeContainer.classList.remove('show');
        }
    }

    function showError(message) {
        const errorDiv = document.getElementById('error');
        errorDiv.textContent = message;
        errorDiv.classList.add('show');

        // Hide resize controls on error
        document.getElementById('resizeControls').classList.remove('show');
    }

    function downloadBarcode() {
        const svg = document.getElementById('barcode');
        const svgData = new XMLSerializer().serializeToString(svg);
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();

        img.onload = function() {
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(img, 0, 0);

            const pngFile = canvas.toDataURL('image/png');
            const downloadLink = document.createElement('a');
            downloadLink.download = 'barcode.png';
            downloadLink.href = pngFile;
            downloadLink.click();
        };

        img.src = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgData)));
    }

    function printBarcode() {
        window.print();
    }

    let mrpVisible = false;
    function toggleMRP() {
        const mrpGroup = document.getElementById('mrpGroup');
        const btn = event.target;

        mrpVisible = !mrpVisible;

        if (mrpVisible) {
            mrpGroup.classList.remove('hidden');
            btn.textContent = '- Remove MRP';
            btn.style.background = 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)';
        } else {
            mrpGroup.classList.add('hidden');
            document.getElementById('mrpInput').value = '';
            btn.textContent = '+ Add MRP';
            btn.style.background = 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)';
        }

        // Recompute barcode number
        updateBarcodeNumber();
    }

    let fieldCounter = 0;
    function addDynamicField() {
        fieldCounter++;
        const container = document.getElementById('dynamicFieldsContainer');

        const fieldDiv = document.createElement('div');
        fieldDiv.className = 'input-group dynamic-field';
        fieldDiv.id = `dynamic-field-${fieldCounter}`;

        fieldDiv.innerHTML = `
                <div style="flex: 1;">
                    <label>Custom Field ${fieldCounter}:</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" placeholder="Field Name" style="flex: 1;">
                        <input type="text" placeholder="Field Value" style="flex: 1;" oninput="updateBarcodeNumber()">
                    </div>
                </div>
                <button class="remove-field-btn" onclick="removeDynamicField(${fieldCounter})">Remove</button>
            `;

        container.appendChild(fieldDiv);

        // Recompute barcode number after adding field
        updateBarcodeNumber();
    }

    function removeDynamicField(id) {
        const field = document.getElementById(`dynamic-field-${id}`);
        if (field) {
            field.remove();
            // Recompute barcode number after removing field
            updateBarcodeNumber();
        }
    }

    function resizeElements() {
        const detailsScale = document.getElementById('detailsFontSize').value;
        const customScale = document.getElementById('customFontSize').value;
        const barcodeScale = document.getElementById('barcodeSize').value;
        const barcodeWidthScale = document.getElementById('barcodeWidth').value;

        // Update display values
        document.getElementById('detailsFontValue').textContent = detailsScale + '%';
        document.getElementById('customFontValue').textContent = customScale + '%';
        document.getElementById('barcodeSizeValue').textContent = barcodeScale + '%';
        document.getElementById('barcodeWidthValue').textContent = barcodeWidthScale + '%';

        // Get original sizes
        const originalDetailsSize = parseFloat(window.originalDetailsFontSize);
        const originalCustomSize = parseFloat(window.originalCustomFontSize);
        const originalBarcodeHeight = window.originalBarcodeHeight;
        const originalBarcodeWidth = window.originalBarcodeWidth || 1.2;

        // Calculate new sizes
        const newDetailsSize = (originalDetailsSize * detailsScale / 100).toFixed(1) + 'pt';
        const newCustomSize = (originalCustomSize * customScale / 100).toFixed(1) + 'pt';

        // Apply to product details
        document.querySelectorAll('.details-display p, .details-display strong, .details-display .colon, .details-display .value').forEach(el => {
            el.style.fontSize = newDetailsSize;
        });

        // Apply to custom fields
        document.querySelectorAll('.custom-field-box .field-label, .custom-field-box .field-value').forEach(el => {
            el.style.fontSize = newCustomSize;
        });

        // Resize barcode
        const barcodeInput = document.getElementById('barcodeInput').value.trim();
        if (barcodeInput) {
            const newBarcodeHeight = Math.round(originalBarcodeHeight * barcodeScale / 100);
            const newBarcodeWidth = (originalBarcodeWidth * barcodeWidthScale / 100).toFixed(1);
            const screenFontSize = window.innerWidth <= 480 ? 14 : 18;

            JsBarcode("#barcode", barcodeInput, {
                format: 'CODE128',
                width: newBarcodeWidth,
                height: newBarcodeHeight,
                displayValue: false,
                fontSize: screenFontSize,
                margin: 10,
                lineColor: "#000000"
            });

            // Update max-height for print
            const barcodeElement = document.getElementById('barcode');
            const newMaxHeight = (parseFloat(window.originalDetailsFontSize) * 2 * barcodeScale / 100).toFixed(1) + 'mm';
            barcodeElement.style.maxHeight = newMaxHeight;
        }
    }

    function resetSizes() {
        // Reset sliders
        document.getElementById('detailsFontSize').value = 150;
        document.getElementById('customFontSize').value = 100;
        document.getElementById('barcodeSize').value = 100;
        document.getElementById('barcodeWidth').value = 100;

        // Reset display values
        document.getElementById('detailsFontValue').textContent = '150%';
        document.getElementById('customFontValue').textContent = '100%';
        document.getElementById('barcodeSizeValue').textContent = '100%';
        document.getElementById('barcodeWidthValue').textContent = '100%';

        // Apply original sizes
        resizeElements();
    }
</script>
</body>
</html>